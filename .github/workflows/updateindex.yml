name: Update IPTV Links

on:
  workflow_dispatch:  # Allows manual trigger from the GitHub UI

jobs:
  update-links:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout ums91/MyTv repository
      uses: actions/checkout@v3
      with:
        repository: ums91/MyTv
        token: ${{ secrets.TV_TOKEN }}

    - name: Checkout ums91/umsiptv repository
      uses: actions/checkout@v3
      with:
        repository: ums91/umsiptv
        token: ${{ secrets.TV_TOKEN }}
        path: umsiptv

    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.8'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt  # If you have any dependencies to install

    - name: Run script to update m3u links
      run: |
        python -c "
import os

source_file_path = 'ums91/MyTv/in.m3u'
target_file_path = 'umsiptv/streams/index.m3u'

def add_m3u_links():
    if not os.path.exists(source_file_path):
        print(f'Source file {source_file_path} does not exist.')
        return

    with open(source_file_path, 'r') as source_file:
        new_links = source_file.readlines()

    if os.path.exists(target_file_path):
        with open(target_file_path, 'r') as target_file:
            existing_links = target_file.readlines()
    else:
        existing_links = []

    updated_links = new_links + existing_links

    with open(target_file_path, 'w') as target_file:
        target_file.writelines(updated_links)

    print(f'Successfully added {len(new_links)} new links to {target_file_path}.')

add_m3u_links()
        "

    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add umsiptv/streams/index.m3u
        git commit -m "Update IPTV links"
        git push origin main
